import os
import sys

root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))
sys.path.append(root)

# ----------------------------------------------------------------------------

# PLEASE DO NOT EDIT THIS FILE, IT IS GENERATED AND WILL BE OVERWRITTEN:
# https://github.com/ccxt/ccxt/blob/master/CONTRIBUTING.md#how-to-contribute-code

# ----------------------------------------------------------------------------
# -*- coding: utf-8 -*-

import ccxt.async_support as ccxt  # noqa: F402
from ccxt.test.exchange.base import test_shared_methods  # noqa E402

def test_aggregate():
    exchange = ccxt.Exchange({
        'id': 'sampleexchange',
    })
    bids = [[789.1, 123], [789.1, 123], [123, 456], [789, 123], [789.1, 123]]
    asks = [[123, 456], [789, 123], [789.1, 123]]
    try:
        test_shared_methods.assert_deep_equal(exchange, None, 'aggregate', exchange.aggregate(exchange.sort_by(bids, 0)), [[123, 456], [789, 123], [789.1, 369]])
        test_shared_methods.assert_deep_equal(exchange, None, 'aggregate', exchange.aggregate(exchange.sort_by(asks, 0)), [[123, 456], [789, 123], [789.1, 123]])
    except Exception as e:
        # skip c# , todo
        if 'BaseTest.assert' in (str(e)) or 'at System.' in (str(e)):
            return
        else:
            raise e
    test_shared_methods.assert_deep_equal(exchange, None, 'aggregate', exchange.aggregate([]), [])
    # Test 1: Simple aggregation - same price combined
    result1 = exchange.aggregate([[100, 1], [101, 2], [100, 0.5]])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result1, [[100, 1.5], [101, 2]])
    # Test 2: With extra fields (should be ignored)
    result2 = exchange.aggregate([[100, 1, 'extra'], [101, 2, 'data', 'more']])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result2, [[100, 1], [101, 2]])
    # Test 3: Zero volumes should be skipped
    result3 = exchange.aggregate([[100, 1], [101, 0], [102, 2]])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result3, [[100, 1], [102, 2]])
    # Test 4: Empty array
    result4 = exchange.aggregate([])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result4, [])
    # Test 5: Single entry
    result5 = exchange.aggregate([[100, 1]])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result5, [[100, 1]])
    # Test 6: Many same prices aggregated
    result6 = exchange.aggregate([[100, 0.1], [100, 0.2], [100, 0.3], [100, 0.4]])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result6, [[100, 1]])
    # Test 7: All zero volumes - empty result
    result7 = exchange.aggregate([[100, 0], [101, 0], [102, 0]])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result7, [])
    # Test 8: Preserves order of first occurrence
    result8 = exchange.aggregate([[103, 1], [101, 1], [102, 1], [101, 0.5]])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result8, [[103, 1], [101, 1.5], [102, 1]])
    # Test 9: Decimal prices
    result9 = exchange.aggregate([[100.5, 1], [100.5, 2], [101.5, 1]])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result9, [[100.5, 3], [101.5, 1]])
    # Test 10: Mixed zero and non-zero for same price
    result10 = exchange.aggregate([[100, 1], [100, 0], [100, 2]])
    test_shared_methods.assert_deep_equal(exchange, None, 'testAggregate', result10, [[100, 3]])
