<?php
namespace ccxt;

// ----------------------------------------------------------------------------

// PLEASE DO NOT EDIT THIS FILE, IT IS GENERATED AND WILL BE OVERWRITTEN:
// https://github.com/ccxt/ccxt/blob/master/CONTRIBUTING.md#how-to-contribute-code

// -----------------------------------------------------------------------------


function test_aggregate() {
    $exchange = new \ccxt\async\Exchange(array(
        'id' => 'sampleexchange',
    ));
    $bids = [[789.1, 123], [789.1, 123], [123, 456], [789, 123], [789.1, 123]];
    $asks = [[123, 456], [789, 123], [789.1, 123]];
    assert_deep_equal($exchange, null, 'aggregate', $exchange->aggregate($exchange->sort_by($bids, 0)), [[123, 456], [789, 123], [789.1, 369]]);
    assert_deep_equal($exchange, null, 'aggregate', $exchange->aggregate($exchange->sort_by($asks, 0)), [[123, 456], [789, 123], [789.1, 123]]);
    assert_deep_equal($exchange, null, 'aggregate', $exchange->aggregate([]), []);
    // Test 1: Simple aggregation - same price combined
    $result1 = $exchange->aggregate([[100, 1], [101, 2], [100, 0.5]]);
    assert_deep_equal($exchange, null, 'testAggregate', $result1, [[100, 1.5], [101, 2]]);
    // Test 2: With extra fields (should be ignored)
    $result2 = $exchange->aggregate([[100, 1, 'extra'], [101, 2, 'data', 'more']]);
    assert_deep_equal($exchange, null, 'testAggregate', $result2, [[100, 1], [101, 2]]);
    // Test 3: Zero volumes should be skipped
    $result3 = $exchange->aggregate([[100, 1], [101, 0], [102, 2]]);
    assert_deep_equal($exchange, null, 'testAggregate', $result3, [[100, 1], [102, 2]]);
    // Test 4: Empty array
    $result4 = $exchange->aggregate([]);
    assert_deep_equal($exchange, null, 'testAggregate', $result4, []);
    // Test 5: Single entry
    $result5 = $exchange->aggregate([[100, 1]]);
    assert_deep_equal($exchange, null, 'testAggregate', $result5, [[100, 1]]);
    // Test 6: Many same prices aggregated
    $result6 = $exchange->aggregate([[100, 0.1], [100, 0.2], [100, 0.3], [100, 0.4]]);
    assert_deep_equal($exchange, null, 'testAggregate', $result6, [[100, 1]]);
    // Test 7: All zero volumes - empty result
    $result7 = $exchange->aggregate([[100, 0], [101, 0], [102, 0]]);
    assert_deep_equal($exchange, null, 'testAggregate', $result7, []);
    // Test 8: Preserves order of first occurrence
    $result8 = $exchange->aggregate([[103, 1], [101, 1], [102, 1], [101, 0.5]]);
    assert_deep_equal($exchange, null, 'testAggregate', $result8, [[103, 1], [101, 1.5], [102, 1]]);
    // Test 9: Decimal prices
    $result9 = $exchange->aggregate([[100.5, 1], [100.5, 2], [101.5, 1]]);
    assert_deep_equal($exchange, null, 'testAggregate', $result9, [[100.5, 3], [101.5, 1]]);
    // Test 10: Mixed zero and non-zero for same price
    $result10 = $exchange->aggregate([[100, 1], [100, 0], [100, 2]]);
    assert_deep_equal($exchange, null, 'testAggregate', $result10, [[100, 3]]);
}
